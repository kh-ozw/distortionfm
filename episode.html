<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Distortion.fm</title>
    <link rel="icon" href="favicon.png" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-420KNS52DK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-420KNS52DK');
    </script>
    <script>
        window.addEventListener("DOMContentLoaded", () => {
            const body = document.getElementsByTagName("body")[0];

            const searchParams = new URLSearchParams(window.location.search);
            const episodeId = searchParams.get("id");

            // エピソード情報を取得
            fetch('https://anchor.fm/s/db286500/podcast/rss')
                .then(res => res.text())
                .then(data => {
                    // RSSフィードをパースしてエピソード（item）を取得する
                    const parser = new window.DOMParser();
                    const feed = parser.parseFromString(data, "text/xml");
                    const items = feed.getElementsByTagName("item");

                    let episode;
                    for (item of items) {
                        const episodeUrl = item.getElementsByTagName("link")[0].textContent;
                        if (episodeUrl.includes(episodeId)) {
                            episode = item;
                            break;
                        }
                    }

                    // title
                    const title = document.createElement("h1");
                    title.innerText = episode.getElementsByTagName("title")[0].textContent;
                    body.appendChild(title);
                    const headTitle = document.getElementsByTagName("title")[0];
                    headTitle.innerText = episode.getElementsByTagName("title")[0].textContent;

                    // プレイヤー
                    const iframe = document.createElement("iframe");
                    iframe.setAttribute("src", `https://podcasters.spotify.com/pod/show/matsumaru/embed/episodes/${episodeId}`);
                    iframe.setAttribute("height", "102px");
                    iframe.setAttribute("width", "400px");
                    iframe.setAttribute("frameborder", "0");
                    iframe.setAttribute("scrolling", "no");
                    body.appendChild(iframe);

                    // description
                    const parsedDescription = parser.parseFromString(episode.getElementsByTagName("description")[0].textContent, "text/html");
                    const description = Array.from(parsedDescription.body.childNodes);
                    // descriptionの要素が<p>で始まらないことがあるので、先頭に空の<p>を挿入
                    body.appendChild(document.createElement("p"));
                    description.forEach(d => body.appendChild(d));

                    // pubDate
                    const pubDate = document.createElement("p");
                    pubDate.innerText = episode.getElementsByTagName("pubDate")[0].textContent;
                    body.appendChild(pubDate);
                });
        });
    </script>
    <style>
        body {
            width: 100%;
            white-space: normal;
        }

        h1 {
            width: 100%;
            border-bottom: solid 1px #000000;
        }

        p {
            font-family: Georgia, "Cambria", serif;
            line-height: 1.8em;
        }
    </style>
</head>
<body>
</body>
</html>