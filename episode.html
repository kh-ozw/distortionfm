<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Distortion.fm</title>
    <link rel="icon" href="favicon.png" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css"
        integrity="sha384-X38yfunGUhNzHpBaEBsWLO+A0HDYOQi8ufWDkZ0k9e0eXz/tH3II7uKZ9msv++Ls" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/grids-responsive-min.css" />
    <link rel="stylesheet" href="styles.css"/>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-420KNS52DK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-420KNS52DK');
    </script>
    <script>
        window.addEventListener("DOMContentLoaded", () => {
            const main = document.getElementsByTagName("main")[0];

            const searchParams = new URLSearchParams(window.location.search);
            const episodeId = searchParams.get("id");

            // エピソード情報を取得
            fetch('https://anchor.fm/s/db286500/podcast/rss')
                .then(res => res.text())
                .then(data => {
                    // RSSフィードをパースしてエピソード（item）を取得する
                    const parser = new window.DOMParser();
                    const feed = parser.parseFromString(data, "text/xml");
                    const items = feed.getElementsByTagName("item");

                    let episode;
                    for (item of items) {
                        const episodeUrl = item.getElementsByTagName("link")[0].textContent;
                        if (episodeUrl.includes(episodeId)) {
                            episode = item;
                            break;
                        }
                    }

                    // title
                    const title = document.createElement("h1");
                    title.innerText = episode.getElementsByTagName("title")[0].textContent;
                    main.appendChild(title);
                    const headTitle = document.getElementsByTagName("title")[0];
                    headTitle.innerText = episode.getElementsByTagName("title")[0].textContent;

                    // プレイヤー
                    const iframe = document.createElement("iframe");
                    iframe.setAttribute("src", `https://podcasters.spotify.com/pod/show/matsumaru/embed/episodes/${episodeId}`);
                    iframe.setAttribute("width", "100%");
                    iframe.setAttribute("frameborder", "0");
                    iframe.setAttribute("scrolling", "no");
                    main.appendChild(iframe);

                    // description
                    const parsedDescription = parser.parseFromString(episode.getElementsByTagName("description")[0].textContent, "text/html");
                    const description = Array.from(parsedDescription.body.childNodes);
                    description.forEach(d => main.appendChild(d));

                    // pubDate
                    const pubDate = document.createElement("p");
                    pubDate.innerText = episode.getElementsByTagName("pubDate")[0].textContent;
                    main.appendChild(pubDate);
                });
        });
    </script>
</head>
<body class="pure-g">
    <header class="pure-u-1 pure-u-xl-1-4">
        <a href="./index.html">Distortion.fm</a>
        <p>1995年生まれの男性が友達と雑談をする。</p>
    </header>
    <main class="pure-u-1 pure-u-xl-3-4"></main>
</body>
</html>